#!/bin/bash

# Define the source file and output binary
SOURCE_FILE="platform_identity.cpp"
OUTPUT_BINARY="platform_identity"
BUILD_DIR="build"

# ANSI color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Color

# Function to clean up build directory
cleanup() {
    echo -e "${YELLOW}Cleaning up...${NC}"
    rm -rf "$BUILD_DIR"
}

# Trap Ctrl+C (SIGINT) and call cleanup
trap cleanup INT

# Create build directory
echo -e "${GREEN}Creating build directory...${NC}"
mkdir -p "$BUILD_DIR"
cd "$BUILD_DIR"

# Compile the C++ code with -Ofast optimization and C++23 standard
echo -e "${GREEN}Compiling the C++ code...${NC}"
g++ -Ofast -std=c++23 "../$SOURCE_FILE" -o "$OUTPUT_BINARY"

# Run the compiled binary
echo -e "${GREEN}Running the compiled binary...${NC}"
./"$OUTPUT_BINARY"

# Clean up build directory after execution
cd ..
cleanup